<?xml version="1.0" encoding="UTF-8"?>
<component-configuration
    xmlns="http://tis.co.jp/nablarch/component-configuration"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://tis.co.jp/nablarch/component-configuration ../../main/resources/component-configuration.xsd">

  <!-- db接続情報設定ファイル -->
  <config-file file="db.config" />

  <!--  SimpleDbTransactionManager  -->
  <component name="tran"
      class="nablarch.core.db.transaction.SimpleDbTransactionManager">
    <property name="dbTransactionName" value="test" />
  </component>

  <!-- ConnectionFactoryの設定 -->
  <component
      class="nablarch.core.db.connection.BasicDbConnectionFactoryForDataSource">
    <property name="dataSource">
      <component class="oracle.jdbc.pool.OracleDataSource">
        <property name="user" value="${db.user}" />
        <property name="password" value="${db.password}" />
        <property name="URL" value="${db.url}" />
      </component>
    </property>
  </component>

  <!-- TransactionFactoryの設定 -->
  <component class="nablarch.core.db.transaction.JdbcTransactionFactory">
    <property name="isolationLevel" value="READ_COMMITTED" />
  </component>

  <!-- StatementFactoryの設定 -->
  <component name="statementFactory"
      class="nablarch.core.db.statement.BasicStatementFactory">
    <property name="sqlStatementExceptionFactory">
      <component
          class="nablarch.core.db.statement.exception.BasicSqlStatementExceptionFactory">
        <!-- Oracleデータベースの場合の一意制約違反のエラーコード -->
        <property name="duplicateErrorErrCode" value="1" />
      </component>
    </property>
    <property name="fetchSize" value="500" />
    <property name="objectFieldCache" ref="fieldAnnotationCache" />
    <property name="updatePreHookObjectHandlerList">
      <list>
        <!-- カレント日付アノテーション用ハンドラ -->
        <component
            class="nablarch.core.db.statement.autoproperty.CurrentDateTimeAnnotationHandler">
          <property name="fieldAnnotationCache" ref="fieldAnnotationCache" />
          <property name="dateProvider">
            <component class="nablarch.core.date.BasicSystemTimeProvider" />
          </property>
        </component>
        <!-- ユーザID用ハンドラ -->
        <component
            class="nablarch.core.db.statement.autoproperty.UserIdAnnotationHandler">
          <property name="fieldAnnotationCache" ref="fieldAnnotationCache" />
        </component>
        <!-- リクエストID用ハンドラ -->
        <component class="nablarch.core.db.statement.autoproperty.RequestIdAnnotationHandler" />
      </list>
    </property>
    <property name="sqlParameterParserFactory">
      <component
          class="nablarch.core.db.statement.BasicSqlParameterParserFactory" />
    </property>
    <property name="sqlLoader" ref="sqlLoader" />
  </component>

  <!-- SQLLoaderの設定 -->
  <component name="sqlLoader" class="nablarch.core.db.statement.BasicSqlLoader">
    <property name="fileEncoding" value="utf-8" />
    <property name="extension" value="sql" />
  </component>

  <!-- フィールド情報ローダーの設定 -->
  <component name="fieldAnnotationCache"
      class="nablarch.core.cache.BasicStaticDataCache">
    <property name="loader">
      <component
          class="nablarch.core.db.statement.autoproperty.FieldAndAnnotationLoader" />
    </property>
    <property name="loadOnStartup" value="false" />
  </component>

</component-configuration>